{
    "metadata": {
        "id": "newSession",
        "name": "New session",
        "description": "Fill session attributes when a new session is created",
        "readOnly":true
    },

    "condition": {
        "type": "sessionCreatedEventCondition",
        "parameterValues": {
        }
    },

    "actions": [
        {
            "type": "setRemoteHostInfoAction",
            "parameterValues": {
            }
        },
        {
            "type": "requestHeaderToUserPropertyAction",
            "parameterValues": {
                "requestHeaderName": "User-Agent",
                "sessionPropertyName": "userAgent"
            }
        },
        {
            "parameterValues": {
                "setPropertyName": "previousVisit",
                "setPropertyValue": "userProperty::lastVisit",
                "storeInSession": null
            },
            "type": "setPropertyAction"
        },
        {
            "parameterValues": {
                "setPropertyName": "lastVisit",
                "setPropertyValue": "now",
                "storeInSession": null
            },
            "type": "setPropertyAction"
        },
        {
            "parameterValues": {
                "setPropertyName": "nbOfVisits",
                "setPropertyValue": "script::user.properties.?nbOfVisits != null ? (user.properties.nbOfVisits + 1) : 1",
                "storeInSession": false
            },
            "type": "setPropertyAction"
        }
    ]

}