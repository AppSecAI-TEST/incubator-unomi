{"metadata": {
    "id": "lastVisit",
    "name": "Last visit",
    "description": "This rule updates the last visit property with the current time and date when an page view event is received."
}, "condition": {
    "parameterValues": {
        "subConditions": [
            {
                "parameterValues": {
                    "eventTypeId": "view"
                },
                "type": "eventCondition"
            }
        ]
    },
    "type": "andCondition"
}, "actions": [
    {
        "parameterValues": {
            "setPropertyName": "lastVisit",
            "setPropertyValue": "now",
            "storeInSession": null
        },
        "type": "setPropertyAction"
    },
    {
        "parameterValues": {
            "setPropertyName": "nbOfVisits",
            "script": "user.properties.?nbOfVisits != null ? (user.properties.nbOfVisits + 1) : 1",
            "storeInSession": false
        },
        "type": "setPropertyAction"
    }
], "raiseEventOnlyOnceForUser": false, "raiseEventOnlyOnceForSession": true}